# Embarcadero Configuration File - Sequencer-Only Head Node
# This config is used for the head node (broker 0) in sequencer-only topology.
# The head node runs only the sequencer with no data ingestion path.
# See docs/memory-bank/SEQUENCER_ONLY_HEAD_NODE_DESIGN.md

embarcadero:
  # Version information
  version:
    major: 1
    minor: 0

  # Cluster configuration (override to all-ingestion when using this file for head)
  cluster:
    is_sequencer_node: false        # Set false so all brokers (including B0) are ingestion brokers
    sequencer_broker_id: 0
    data_broker_ids: [0, 1, 2, 3]   # All 4 brokers accept publishes

  # Broker settings
  broker:
    port: 1214                    # Main broker port
    broker_port: 12140           # Alternative broker port
    heartbeat_interval: 3        # Heartbeat interval in seconds
    max_brokers: 5               # 1 head + 4 ingestion brokers
    cgroup_core: 85              # CPU core for cgroup assignment

  # CXL memory configuration
  cxl:
    size: 68719476736            # CXL memory size (64GB)
    emulation_size: 34359738368  # CXL emulation memory size (32GB)
    device_path: "/dev/dax0.0"   # CXL device path
    numa_node: 2                 # NUMA node for CXL memory

  # Storage configuration
  storage:
    segment_size: 4294967296      # Segment size (4GB) to ensure >=1 segment per broker
    batch_headers_size: 10485760  # 10MB batch header ring
    batch_size: 2097152          # 2MB batch size
    num_disks: 2                 # Number of disks for storage
    max_topics: 32               # Maximum number of topics
    topic_name_size: 31          # Maximum topic name length
    use_new_bmeta: true          # Enable dual-write to BrokerMetadata (Bmeta)

  # Network configuration
  network:
    io_threads: 12               # Number of network IO threads
    disk_io_threads: 4           # Number of disk IO threads
    sub_connections: 3           # Connections per broker for subscribers
    zero_copy_send_limit: 65536  # 64KB threshold for MSG_ZEROCOPY

  # Corfu sequencer configuration
  corfu:
    sequencer_port: 50052
    replication_port: 50053

  # Scalog sequencer configuration
  scalog:
    sequencer_port: 50051
    replication_port: 50052
    sequencer_ip: "192.168.60.173"
    local_cut_interval: 100

  # Platform detection
  platform:
    is_intel: false
    is_amd: false
